#!/usr/bin/env ruby

# Looks like no directions repeat

require "pry"
require "pry-byebug"

class Point
  include Comparable

  def self.[](...) = new(...)

  attr_accessor :x, :y

  def initialize(x, y)
    self.x = x
    self.y = y
  end

  def to_s = "(#{x},#{y})"

  def ==(other)
    if other.is_a?(Point)
      other.x == x && other.y == y
    end
  end

  def eql?(other) = self == other

  def hash
    [x, y].hash
  end

  def <=>(other)
    cmp = x <=> other.x
    cmp.zero? ? y <=> other.y : cmp
  end
end

class Floor
  attr_accessor :points, :border_tiles # , :filled_tiles

  def initialize(input_string)
    rows = input_string.split("\n")
    self.points = rows.map do |row|
      coordinates = row.split(",").map(&:to_i)
      Point[*coordinates]
    end

    build_border_tiles
  end

  def build_border_tiles
    self.border_tiles = []

    first_point = points.first
    previous_point = first_point

    points[1..].each do |next_point|
      fill_in_border_tiles(previous_point, next_point)
      previous_point = next_point
    end

    previous_point = points.last

    fill_in_border_tiles(previous_point, first_point)

    border_tiles.uniq!
    border_tiles.sort!
  end

  def fill_in_border_tiles(p1, p2)
    if p1.x == p2.x
      x = p1.x

      if p2.y > p1.y
        y1 = p1.y
        y2 = p2.y
      else
        y1 = p2.y
        y2 = p1.y
      end

      y1.upto(y2) { |y| border_tiles << Point[x, y] }
    else
      y = p1.y

      if p2.x > p1.x
        x1 = p1.x
        x2 = p2.x
      else
        x1 = p2.x
        x2 = p1.x
      end

      x1.upto(x2) { |x| border_tiles << Point[x, y] }
    end
  end

  def biggest_rectangle
    points_size = points.size
    biggest_area = 0

    0.upto(points_size - 2) do |corner1_index|
      corner1 = points[corner1_index]
      corner1_index.upto(points_size - 1) do |corner2_index|
        corner2 = points[corner2_index]

        area = ((corner1.x - corner2.x + 1) * (corner1.y - corner2.y + 1)).abs

        if area > biggest_area
          biggest_area = area
        end
      end
    end

    biggest_area
  end
end

input_string = File.read("inputs_test.txt")

floor = Floor.new(input_string)

# puts floor.biggest_rectangle
binding.pry

min_x = floor.points.map(&:x).min
puts floor.points.select { |p| p.x == min_x }.inspect
